const { sql, getConnection } = require("../config/RapidoSeguro");

const entregaModel = {

    inserirEntrega: async (idPedido, valorDistancia, valorPeso, acrescimo, desconto, taxaExtra, valorFinal, statusEntrega) => {
        try {
            const pool = await getConnection();
    
            let querysql = `
                INSERT INTO Entregas (
                    idPedido,
                    valorDistancia,
                    valorPeso,
                    acrescimo,
                    desconto,
                    taxaExtra,
                    valorFinal,
                    statusEntrega
                ) VALUES (
                    @idPedido,
                    @valorDistancia,
                    @valorPeso,
                    @acrescimo,
                    @desconto,
                    @taxaExtra,
                    @valorFinal,
                    @statusEntrega
                )
            `;
    
            await pool.request()
                .input('idPedido', sql.UniqueIdentifier, idPedido) 
                .input('valorDistancia', sql.Decimal(10,2), valorDistancia)
                .input('valorPeso', sql.Decimal(10,2), valorPeso)
                .input('acrescimo', sql.Decimal(10,2), acrescimo)
                .input('desconto', sql.Decimal(10,2), desconto)
                .input('taxaExtra', sql.Decimal(10,2), taxaExtra)
                .input('valorFinal', sql.Decimal(10,2), valorFinal)
                .input('statusEntrega', sql.VarChar(11), statusEntrega) 
                .query(querysql);
    
        } catch (error) {
            console.error(`Erro ao inserir entrega:`, error);
            throw error;
        }
    },
    
    buscarUmaEntrega: async (idEntrega) => {
        try {
            const pool = await getConnection();
    
            const querySQL = "SELECT * FROM Entregas WHERE idEntrega = @idEntrega";
    
            const result = await pool
                .request()
                .input('idEntrega', sql.UniqueIdentifier, idEntrega)
                .query(querySQL);
    
            return result.recordset; // retorna os dados da entrega encontrada
    
        } catch (error) {
            console.error(`Erro ao buscar entrega:`, error);
            throw error;
        }
    },
    
}

module.exports = { entregaModel };